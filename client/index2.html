<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <!-- Add Prism.js CSS and JS -->
  </head>
  <body>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
    <style>
      #messageInput {
        border-radius: 10px !important;
      }
      #main {
        padding-top: 0px;
      }
      #content {
        margin-bottom: 0px !important;
      }

      /* Add these styles to match kr2.html */
      .fusion-builder-row {
        max-width: 100vw !important;
        margin-left: 0px !important;
        margin-right: 0px !important;
      }

      .fusion-builder-row-1 {
        padding-top: 10px !important;
        padding-bottom: 10px !important;
      }

      .fusion-page-title-bar {
        display: none;
      }

      #main {
        padding: 0px !important;
        width: 100% !important;
      }

      .fusion-column-wrapper {
        margin: 0px !important;
      }

      .fusion-layout-column {
        margin: 0px !important;
      }

      /* Add these styles for better code display */
      pre {
        background: #1f2937 !important;
        border-radius: 0.5rem;
        padding: 1rem !important;
        margin: 0 !important;
      }

      code {
        font-family: "Fira Code", monospace !important;
        font-size: 0.875rem !important;
        line-height: 1.5 !important;
      }
    </style>
    <div class="bg-gray-900">
      <script src="https://cdn.tailwindcss.com"></script>
      <div class="p-4">
        <div
          class="max-w-2xl mx-auto mb-6 bg-gray-800 rounded-lg shadow-lg p-6"
          id="imageUpload"
        >
          <h2 class="text-2xl font-bold mb-2 text-gray-100">
            UI to Code Converter
          </h2>
          <p class="text-gray-400 mb-4">
            Transform your UI designs into clean, production-ready code
          </p>
          <div
            class="border-2 border-dashed border-gray-600 rounded-lg p-8 text-center hover:border-blue-500 transition-colors"
          >
            <input type="file" id="fileInput" class="hidden" accept="image/*" />
            <div id="previewContainer" class="hidden mb-4">
              <img
                id="imagePreview"
                class="mx-auto h-48 object-contain rounded-lg"
              />
            </div>
            <label for="fileInput" class="cursor-pointer">
              <svg
                class="mx-auto h-12 w-12 text-gray-500"
                stroke="currentColor"
                fill="none"
                viewBox="0 0 48 48"
              >
                <path
                  d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <p class="mt-2 text-sm text-gray-400">
                Upload your UI design image
              </p>
              <p class="mt-1 text-xs text-gray-500">
                Supports PNG, JPG, GIF up to 10MB
              </p>
            </label>
          </div>
          <div class="mt-4 flex justify-center">
            <button
              id="analyzeButton"
              class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors"
            >
              Convert to Code
            </button>
          </div>
        </div>

        <div class="hidden" id="chatInterface">
          <div class="flex gap-6">
            <div
              class="w-1/4 bg-gray-800 rounded-lg shadow-lg p-4 h-[calc(100vh-2rem)] flex flex-col"
            >
              <h3 class="text-lg font-semibold mb-4 !text-gray-100">History</h3>
              <div
                class="space-y-4 overflow-y-auto flex-1 scrollbar-custom"
                id="imageHistory"
              >
                <!-- Image history items will be added here -->
              </div>
            </div>

            <div class="w-3/4 space-y-3">
              <div
                class="bg-gray-800 rounded-lg shadow-lg p-6 h-[calc(100vh-8rem)] overflow-y-auto scrollbar-custom"
              >
                <div class="flex justify-between items-center">
                  <div class="">
                    <h3 class="text-lg font-semibold mb-4 !text-gray-100">
                      Output
                    </h3>
                  </div>
                  <div class="flex gap-2">
                    <button
                      id="previewButton"
                      class="bg-gray-700 hover:bg-gray-600 text-gray-300 px-4 py-2 rounded-lg transition-colors"
                    >
                      Preview
                    </button>
                    <button
                      id="codeButton"
                      class="bg-gray-700 hover:bg-gray-600 text-gray-300 px-4 py-2 rounded-lg transition-colors"
                    >
                      Code
                    </button>
                    <button
                      id="newTabButton"
                      class="bg-gray-700 hover:bg-gray-600 text-gray-300 px-4 py-2 rounded-lg transition-colors"
                    >
                      Open in new tab
                    </button>
                  </div>
                </div>
                <div
                  id="outputContent"
                  class="prose prose-invert max-w-none max-h-[calc(100vh-16rem)] overflow-y-auto scrollbar-custom"
                >
                  <div id="previewContent" class="hidden">
                    <!-- Preview iframe will be inserted here -->
                  </div>
                  <div id="codeContent" class="hidden">
                    <pre><code class="language-html"></code></pre>
                  </div>
                </div>
              </div>

              <div class="!bg-gray-800 !rounded-lg !shadow-lg p-4">
                <div class="flex items-center gap-3">
                  <input
                    type="text"
                    id="messageInput"
                    class="flex-1 !bg-gray-700 border-gray-600 !text-gray-100 !rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-400"
                    placeholder="Type your message here..."
                  />
                  <button
                    id="newImageButton"
                    class="bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-full w-10 h-10 flex items-center justify-center transition-colors"
                    title="Upload new image"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-6 w-6"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 4v16m8-8H4"
                      />
                    </svg>
                  </button>
                  <button
                    id="sendButton"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors"
                  >
                    Send
                  </button>
                  <input
                    type="file"
                    id="newFileInput"
                    class="hidden"
                    accept="image/*"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <script>
        // Initially disable the send button and input
        document.getElementById("sendButton").disabled = true;
        document.getElementById("messageInput").disabled = true;

        document
          .getElementById("analyzeButton")
          .addEventListener("click", async function () {
            const fileInput = document.getElementById("fileInput");
            if (fileInput.files && fileInput.files[0]) {
              // Show loading state and chat interface
              document.getElementById("imageUpload").classList.add("hidden");
              document
                .getElementById("chatInterface")
                .classList.remove("hidden");

              // Add the uploaded image to history immediately
              const reader = new FileReader();
              reader.onload = function (e) {
                const historyDiv = document.getElementById("imageHistory");
                const newImage = document.createElement("div");
                newImage.className =
                  "border border-gray-700 rounded-lg p-2 hover:bg-gray-700 cursor-pointer transition-colors mb-3";
                newImage.innerHTML = `
                <img src="${e.target.result}" alt="Uploaded image" class="w-full h-32 object-cover rounded-lg mb-2">
                <p class="text-sm text-gray-400 truncate">${fileInput.files[0].name}</p>
              `;
                historyDiv.appendChild(newImage);
              };
              reader.readAsDataURL(fileInput.files[0]);

              // Show loading animation in both preview and code views
              const previewContent = document.getElementById("previewContent");
              const codeContent = document.getElementById("codeContent");
              const codeElement = codeContent.querySelector("code");

              previewContent.innerHTML = loadingAnimation;
              codeElement.innerHTML = loadingAnimation;

              // Create FormData and append the file
              const formData = new FormData();
              formData.append("image", fileInput.files[0]);

              try {
                // Make API request
                const response = await fetch(
                  "https://ui-to-code.onrender.com/api/generate",
                  {
                    method: "POST",
                    body: formData,
                  }
                );

                const data = await response.json();

                // Extract HTML code from the response
                const htmlCode = data.response.match(
                  /```html\n([\s\S]*?)\n```/
                )[1];

                // Update code view with syntax highlighting
                codeElement.textContent = htmlCode;
                codeElement.className = "language-html";
                Prism.highlightElement(codeElement);

                // Update preview iframe
                const iframe = document.createElement("iframe");
                iframe.style.width = "100%";
                iframe.style.height = "500px";
                iframe.style.border = "none";
                iframe.style.backgroundColor = "white";
                previewContent.innerHTML = ""; // Clear existing content
                previewContent.appendChild(iframe);

                // Write the code to the iframe with default white background
                iframe.contentDocument.open();
                iframe.contentDocument.write(`
                <style>
                  body { 
                    margin: 0; 
                    background: white;
                  }
                </style>
                ${htmlCode}
              `);
                iframe.contentDocument.close();

                // Update sampleCode variable for "Open in new tab" functionality
                window.sampleCode = `
                <style>
                  body { 
                    margin: 0; 
                    background: white;
                  }
                </style>
                ${htmlCode}
              `;

                // Enable the send button and input after image is uploaded
                document.getElementById("sendButton").disabled = false;
                document.getElementById("messageInput").disabled = false;
              } catch (error) {
                console.error("Error:", error);
                // Handle error appropriately
              }
            }
          });
        // Preview image on file select
        document
          .getElementById("fileInput")
          .addEventListener("change", function (e) {
            if (this.files && this.files[0]) {
              // Enable analyze button
              document.getElementById("analyzeButton").disabled = false;

              // Show image preview
              const reader = new FileReader();
              reader.onload = function (e) {
                const previewContainer =
                  document.getElementById("previewContainer");
                const imagePreview = document.getElementById("imagePreview");
                imagePreview.src = e.target.result;
                previewContainer.classList.remove("hidden");
              };
              reader.readAsDataURL(this.files[0]);
            }
          });

        // Handle sending messages
        document
          .getElementById("sendButton")
          .addEventListener("click", sendMessage);
        document
          .getElementById("messageInput")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              sendMessage();
            }
          });

        function sendMessage() {
          const messageInput = document.getElementById("messageInput");
          const message = messageInput.value.trim();

          if (message) {
            const historyDiv = document.getElementById("imageHistory");
            const messageElement = document.createElement("div");
            messageElement.className = "mb-3";
            messageElement.innerHTML = `
          <div class="flex flex-col space-y-2">
            <!-- User message (right-aligned) -->
            <div class="flex justify-end">
              <div class="bg-blue-600 text-white rounded-lg py-2 px-4 max-w-[80%]">
                <p class="text-sm">${message}</p>
              </div>
            </div>
            <!-- AI response (left-aligned) -->
            <div class="flex justify-start">
              <div class="bg-gray-700 text-gray-100 rounded-lg py-2 px-4 max-w-[80%]">
                <p class="text-sm">This is a sample response. Replace with actual AI response.</p>
              </div>
            </div>
          </div>
        `;
            historyDiv.appendChild(messageElement);

            // Clear input after sending
            messageInput.value = "";

            // Force a reflow
            setTimeout(() => {
              historyDiv.scrollTop = historyDiv.scrollHeight;
            }, 0);
          }
        }

        // Handle new image upload button
        document
          .getElementById("newImageButton")
          .addEventListener("click", function () {
            document.getElementById("newFileInput").click();
          });

        document
          .getElementById("newFileInput")
          .addEventListener("change", function (e) {
            if (this.files && this.files[0]) {
              const reader = new FileReader();
              reader.onload = function (e) {
                const historyDiv = document.getElementById("imageHistory");
                const newImage = document.createElement("div");
                newImage.className =
                  "border border-gray-700 rounded-lg p-2 hover:bg-gray-700 cursor-pointer transition-colors mb-3";
                newImage.innerHTML = `
            <img src="${e.target.result}" alt="Uploaded image" class="w-full h-32 object-cover rounded-lg mb-2">
            <p class="text-sm text-gray-400 truncate">${this.files[0].name}</p>
          `;
                historyDiv.appendChild(newImage);

                // Force a reflow and scroll after image loads
                newImage.querySelector("img").onload = () => {
                  setTimeout(() => {
                    historyDiv.scrollTop = historyDiv.scrollHeight;
                  }, 0);
                };
              }.bind(this);
              reader.readAsDataURL(this.files[0]);
            }
          });

        const previewButton = document.getElementById("previewButton");
        const codeButton = document.getElementById("codeButton");
        const newTabButton = document.getElementById("newTabButton");
        const previewContent = document.getElementById("previewContent");
        const codeContent = document.getElementById("codeContent");
        const codeElement = codeContent.querySelector("code");

        // Replace the loadingAnimation constant with this new version
        const loadingAnimation = `
<div class="flex flex-col items-center justify-center min-h-[500px] bg-gray-900">
<div class="relative">
  <!-- Main circle -->
  <div class="w-24 h-24 rounded-full border-[3px] border-blue-500/20 relative">
    <!-- Spinning arc -->
    <div class="absolute inset-0 rounded-full border-[3px] border-blue-500 border-t-transparent animate-[spin_1s_cubic-bezier(0.55,0.25,0.25,0.70)_infinite]"></div>
    
    <!-- Pulsing center -->
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
      <div class="w-12 h-12 bg-blue-500/10 rounded-full animate-[pulse_2s_infinite]"></div>
    </div>
  </div>
</div>

<!-- Loading text -->
<div class="mt-8 text-center">
  <h3 class="text-xl font-semibold text-gray-200 mb-2">Analyzing Design</h3>
  <p class="text-sm text-gray-400">Converting your image into clean code</p>
</div>
</div>`;

        // Show loading animation in code view by default
        codeContent.classList.remove("hidden");
        previewContent.classList.add("hidden");
        codeElement.innerHTML = loadingAnimation;

        previewButton.addEventListener("click", () => {
          previewContent.classList.remove("hidden");
          codeContent.classList.add("hidden");

          // Create iframe for preview if it doesn't exist
          if (!previewContent.querySelector("iframe")) {
            const iframe = document.createElement("iframe");
            iframe.style.width = "100%";
            iframe.style.height = "500px";
            iframe.style.border = "none";
            iframe.style.backgroundColor = "white";
            previewContent.appendChild(iframe);

            // Write the loading animation to the iframe
            iframe.contentDocument.open();
            iframe.contentDocument.write(`
            <style>
              body { 
                margin: 0; 
                background: white;
              }
            </style>
            ${loadingAnimation}
          `);
            iframe.contentDocument.close();
          }
        });

        codeButton.addEventListener("click", () => {
          previewContent.classList.add("hidden");
          codeContent.classList.remove("hidden");
        });

        newTabButton.addEventListener("click", () => {
          const newWindow = window.open();
          newWindow.document.write(`
          <style>
            body { margin: 0; }
          </style>
          ${window.sampleCode || loadingAnimation}
        `);
          newWindow.document.close();
        });
      </script>

      <style>
        /* Custom scrollbar styling */
        .scrollbar-custom::-webkit-scrollbar {
          width: 8px;
        }

        .scrollbar-custom::-webkit-scrollbar-track {
          background: #1f2937; /* gray-800 */
          border-radius: 4px;
        }

        .scrollbar-custom::-webkit-scrollbar-thumb {
          background: #4b5563; /* gray-600 */
          border-radius: 4px;
        }

        .scrollbar-custom::-webkit-scrollbar-thumb:hover {
          background: #6b7280; /* gray-500 */
        }

        /* Firefox scrollbar styling */
        .scrollbar-custom {
          scrollbar-width: thin;
          scrollbar-color: #4b5563 #1f2937;
        }

        @keyframes bounce {
          0%,
          100% {
            transform: translateY(0);
          }
          50% {
            transform: translateY(-4px);
          }
        }

        @keyframes spin {
          from {
            transform: rotate(0deg);
          }
          to {
            transform: rotate(360deg);
          }
        }

        @keyframes pulse {
          0%,
          100% {
            transform: scale(1);
            opacity: 0.5;
          }
          50% {
            transform: scale(1.1);
            opacity: 0.8;
          }
        }
      </style>
    </div>
  </body>
</html>
